<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>菜单编辑器 Pro v4.0</title>
    <link rel="stylesheet" href="/static/style.css?v=2.0.0">
</head>
<body>

<div class="sidebar">
    <!-- 0. 菜单管理 -->
    <div class="sidebar-header-top">
        <label>当前编辑菜单</label>
        <div style="display:flex; gap:5px; margin-bottom:5px;">
            <select id="menuSelect" onchange="switchMenu(this.value)" style="flex:1"></select>
            <button class="icon-btn" onclick="createNewMenu()" title="新建">+</button>
        </div>
        <div style="display:flex; gap:5px;">
            <input id="menuNameInput" placeholder="菜单名称" oninput="updateMenuMeta('name', this.value)" style="flex:1">
            <button class="icon-btn" id="enableBtn" onclick="toggleEnable()" title="开关">启用</button>
            <button class="icon-btn" style="color:#f56c6c; border-color:#f56c6c" onclick="deleteMenu()" title="删除">🗑️</button>
        </div>
    </div>

    <div class="sidebar-header">
        <h3>🛠️ 配置面板</h3>
        <div style="display:flex; gap:5px;">
            <button class="btn btn-secondary" onclick="exportImage()">📷 导出</button>
            <button class="btn btn-primary" onclick="saveAll()">💾 保存</button>
        </div>
    </div>

    <div class="sidebar-content">
        <!-- 1. 画布与背景 -->
        <div class="section">
            <div class="section-title">画布与背景</div>
            <div class="form-row">
                <label>导出模式</label>
                <select id="canvasMode" onchange="updateMenuMeta('use_canvas_size', this.value === 'true')">
                    <option value="false">📐 自动包裹内容</option>
                    <option value="true">🖼️ 固定画布尺寸</option>
                </select>
            </div>
            <div class="form-grid-2">
                <div>
                    <label>画布宽高</label>
                    <div style="display:flex; gap:5px"><input type="number" id="cvsW" placeholder="W" oninput="updateMenuMeta('canvas_width', this.value)"><input type="number" id="cvsH" placeholder="H" oninput="updateMenuMeta('canvas_height', this.value)"></div>
                </div>
                <div>
                    <label>画布底色</label>
                    <div class="color-picker-row"><input type="color" id="cvsColorP" oninput="updateColor('canvas_color', this.value, 'pick')"><input type="text" id="cvsColorT" class="color-value" oninput="updateColor('canvas_color', this.value, 'text')"></div>
                </div>
            </div>
            <hr style="border:0; border-top:1px dashed #444; margin:10px 0">
            <div class="form-row">
                <label>背景图片</label>
                <div style="display:flex; gap:5px;">
                    <select id="bgSelect" onchange="updateBg(this.value)" style="flex:1"></select>
                    <button class="btn btn-secondary" onclick="document.getElementById('bgUp').click()">⬆</button>
                    <input type="file" id="bgUp" hidden onchange="uploadFile('background', this)">
                </div>
            </div>
            <div class="form-grid-2">
                <div><label>模式</label><select id="bgFit" onchange="updateMenuMeta('bg_fit_mode', this.value)"><option value="cover_w">横向填满</option><option value="custom">自定义尺寸</option></select></div>
                <div><label>自定义尺寸</label><div style="display:flex; gap:2px"><input type="number" id="bgW" placeholder="W" oninput="updateMenuMeta('bg_custom_width', this.value)"><input type="number" id="bgH" placeholder="H" oninput="updateMenuMeta('bg_custom_height', this.value)"></div></div>
            </div>
            <div class="form-row"><label>对齐</label><div style="display:flex; gap:5px"><select id="bgAlignX" onchange="updateMenuMeta('bg_align_x', this.value)"><option value="left">左对齐</option><option value="center">水平居中</option><option value="right">右对齐</option></select><select id="bgAlignY" onchange="updateMenuMeta('bg_align_y', this.value)"><option value="top">顶部对齐</option><option value="center">垂直居中</option><option value="bottom">底部对齐</option></select></div></div>
            <div class="form-row"><label>🏷️ 分组框样式</label><div class="form-grid-2"><div><input type="color" id="boxColor" oninput="updateMenuMeta('box_bg_color', this.value)" style="width:100%"></div><div><input type="number" id="boxBlur" oninput="updateMenuMeta('box_blur_radius', this.value)" placeholder="模糊半径"></div></div><input type="range" min="0" max="255" id="boxAlpha" oninput="updateMenuMeta('box_bg_alpha', this.value); document.getElementById('alphaVal').innerText=this.value"><span id="alphaVal" style="float:right; font-size:10px">120</span></div>
            <div class="form-row"><label>布局列数</label><input type="number" id="columnInput" min="1" max="10" oninput="updateMenuMeta('layout_columns', parseInt(this.value))"></div>
        </div>

        <!-- 2. 详细配色 -->
        <div class="section">
            <div class="section-title">全局配色</div>
            <div class="form-row">
                <label>🎨 主标题颜色</label>
                <div class="color-picker-row"><input type="color" id="cTitleP" oninput="updateColor('title_color', this.value, 'pick')"><input type="text" id="cTitleT" class="color-value" oninput="updateColor('title_color', this.value, 'text')"></div>
            </div>
            <div class="form-row">
                <label>🎨 副标题颜色</label>
                <div class="color-picker-row"><input type="color" id="cSubP" oninput="updateColor('subtitle_color', this.value, 'pick')"><input type="text" id="cSubT" class="color-value" oninput="updateColor('subtitle_color', this.value, 'text')"></div>
            </div>
            <div class="form-row">
                <label>🎨 分组标题颜色</label>
                <div class="color-picker-row"><input type="color" id="cGTitleP" oninput="updateColor('group_title_color', this.value, 'pick')"><input type="text" id="cGTitleT" class="color-value" oninput="updateColor('group_title_color', this.value, 'text')"></div>
            </div>
            <div class="form-row">
                <label>🎨 分组副标题颜色</label>
                <div class="color-picker-row"><input type="color" id="cGSubP" oninput="updateColor('group_sub_color', this.value, 'pick')"><input type="text" id="cGSubT" class="color-value" oninput="updateColor('group_sub_color', this.value, 'text')"></div>
            </div>
            <div class="form-row">
                <label>🎨 功能名颜色</label>
                <div class="color-picker-row"><input type="color" id="cItemNameP" oninput="updateColor('item_name_color', this.value, 'pick')"><input type="text" id="cItemNameT" class="color-value" oninput="updateColor('item_name_color', this.value, 'text')"></div>
            </div>
            <div class="form-row">
                <label>🎨 描述文字颜色</label>
                <div class="color-picker-row"><input type="color" id="cItemDescP" oninput="updateColor('item_desc_color', this.value, 'pick')"><input type="text" id="cItemDescT" class="color-value" oninput="updateColor('item_desc_color', this.value, 'text')"></div>
            </div>
        </div>

        <!-- 3. 字体设置 -->
        <div class="section">
            <div class="section-title">全局字体</div>
            <div class="form-row"><label>主/副标题字体</label><select id="fTitle" onchange="updateMenuMeta('title_font', this.value)"></select></div>
            <div class="form-row"><label>分组标题字体</label><select id="fGTitle" onchange="updateMenuMeta('group_title_font', this.value)"></select></div>
            <div class="form-row"><label>分组副标题字体</label><select id="fGSub" onchange="updateMenuMeta('group_sub_font', this.value)"></select></div>
            <div class="form-row"><label>功能名字体</label><select id="fIName" onchange="updateMenuMeta('item_name_font', this.value)"></select></div>
            <div class="form-row"><label>功能描述字体</label><select id="fIDesc" onchange="updateMenuMeta('item_desc_font', this.value)"></select></div>

            <button class="btn btn-secondary btn-block" style="margin-top:5px" onclick="document.getElementById('fontUp').click()">📤 上传新字体</button>
            <input type="file" id="fontUp" hidden accept=".ttf,.otf" onchange="uploadFile('font', this)">
        </div>

        <!-- 4. 标题内容 -->
        <div class="section">
            <div class="section-title">标题内容</div>
            <div class="form-row"><label>对齐</label><select id="alignSelect" onchange="updateMenuMeta('title_align', this.value)"><option value="left">居左</option><option value="center">居中</option><option value="right">居右</option></select></div>
            <div class="form-row"><label>主标题</label><input type="text" id="mainTitleInput" oninput="updateMenuMeta('title', this.value)"></div>
            <div class="form-row"><label>副标题</label><input type="text" id="subTitleInput" oninput="updateMenuMeta('sub_title', this.value)"></div>
        </div>

        <!-- 5. 分组与组件 -->
        <div class="section">
            <div class="section-title">分组管理 <button class="icon-btn" onclick="addGroup()">+ 新增</button></div>
            <div id="groupList" class="group-list"></div>
        </div>
        <div class="section">
            <div class="section-title">自定义组件 <div style="display:inline-block"><button class="icon-btn" onclick="addWidget('text')">+文</button> <button class="icon-btn" onclick="addWidget('image')">+图</button></div></div>
            <div id="widgetEditor" style="display:none; background:#333; padding:10px; border-radius:4px; margin-top:5px;">
                <div id="wEdit-text" style="display:none"><input id="widText" oninput="updateWidget('text', this.value)" style="margin-bottom:5px;width:100%"><div style="display:flex;gap:5px"><input type="number" id="widSize" oninput="updateWidget('size', this.value)" style="width:60px"><input type="color" id="widColor" oninput="updateWidget('color', this.value)" style="width:40px"></div></div>
                <div id="wEdit-image" style="display:none"><div style="display:flex;gap:5px"><select id="widImgSelect" onchange="updateWidget('content', this.value)" style="flex:1"></select><button class="btn btn-secondary" onclick="document.getElementById('widImgUp').click()">⬆</button><input type="file" id="widImgUp" hidden onchange="uploadFile('widget_img', this)"></div><div style="display:flex;gap:5px;margin-top:5px"><input type="number" id="widW" oninput="updateWidget('width', this.value)"><input type="number" id="widH" oninput="updateWidget('height', this.value)"></div></div>
                <button class="btn btn-danger btn-block" style="margin-top:5px" onclick="deleteWidget()">删除</button>
            </div>
        </div>
         <div class="section">
             <div class="section-title">图标资源</div>
             <button class="btn btn-secondary btn-block" onclick="document.getElementById('iconUp').click()">📤 上传图标</button>
             <input type="file" id="iconUp" hidden onchange="uploadFile('icon', this)">
        </div>
    </div>
</div>

<div class="workspace">
    <div id="canvas" class="canvas"></div>
</div>

<div id="editModal" class="modal-overlay">
    <div class="modal">
        <h3 id="modalTitle">编辑</h3>
        <div class="form-row"><label>名称</label><input id="editName"></div>
        <div class="form-row" id="rowSub"><label>副标题</label><input id="editSub"></div>
        <div class="form-row" id="rowDesc"><label>描述</label><input id="editDesc"></div>
        <div class="form-row" id="rowIcon"><label>图标</label><select id="editIcon"></select></div>
        <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:20px;">
            <button class="btn btn-danger" onclick="deleteCurrentItem()">删除</button>
            <button class="btn btn-secondary" onclick="closeModal()">取消</button>
            <button class="btn btn-primary" onclick="saveModal()">确定</button>
        </div>
    </div>
</div>

<script src="/static/editor.js?v=2.0.0"></script>
</body>
</html>
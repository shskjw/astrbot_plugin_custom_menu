<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>菜单编辑器 v1.5 </title>
    <link rel="stylesheet" href="/static/style.css?v=1.5">
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header-top">
        <label>当前编辑菜单</label>
        <div style="display:flex; gap:5px; margin-bottom:5px;">
            <select id="menuSelect" onchange="switchMenu(this.value)" style="flex:1"></select>
            <!-- 保留原有的新建按钮 -->
            <button class="icon-btn" onclick="createNewMenu()" title="新建空白菜单">+</button>
        </div>
        <div style="display:flex; gap:5px;">
            <input id="menuNameInput" placeholder="名称" oninput="updateMenuMeta('name', this.value)" style="flex:1">
            <button class="icon-btn" id="enableBtn" onclick="toggleEnable()">启用</button>

            <!-- [新增] 复制按钮 -->
            <button class="icon-btn" onclick="duplicateMenu()" title="复制当前模板">📑</button>

            <button class="icon-btn" style="color:#f56c6c; border-color:#f56c6c" onclick="deleteMenu()" title="删除">🗑️</button>
        </div>
    </div>

    <!-- === 模式 1: 选中元素的属性面板 === -->
    <div id="propPanel" class="sidebar-content" style="display:none; background:#252526;">
        <div class="sidebar-header" style="background:#2d2d2d; margin-bottom:15px; border-bottom:1px solid #000;">
            <div style="display:flex; justify-content:space-between; align-items:center; width:100%">
                <h3 id="propTitle">🎨 元素属性</h3>
                <button class="btn btn-secondary" style="font-size:12px; padding:4px 8px;" onclick="clearSelection()">返回全局设置</button>
            </div>
            <div id="propDesc" style="font-size:12px; color:#888; margin-top:5px;"></div>
        </div>

        <div id="propContent" style="padding: 0 15px;">
            <!-- JS 动态生成内容 -->
        </div>
    </div>

    <!-- === 模式 2: 全局设置面板 === -->
    <div id="globalPanel" class="sidebar-content">
        <div class="sidebar-header">
            <h3>🛠️ 全局配置</h3>
            <div style="display:flex; gap:5px;">
                <button class="btn btn-secondary" onclick="exportImage()">📷</button>
                <button class="btn btn-primary" onclick="saveAll()">💾</button>
            </div>
        </div>

        <div style="padding:20px;">
            <!-- 1. 基础设置 -->
            <div class="section">
                <div class="section-title">画布与布局</div>
                <div class="form-row">
                    <label>画布模式</label>
                    <select id="canvasMode" onchange="updateMenuMeta('use_canvas_size', this.value)">
                        <option value="false">↕️ 自动高度 (宽度固定)</option>
                        <option value="true">🔲 自定义固定尺寸</option>
                    </select>
                </div>
                <div class="form-grid-2">
                    <div><label>宽 (只能1000)</label><input type="number" id="cvsW" oninput="updateMenuMeta('canvas_width', this.value)"></div>
                    <div><label>高 (px)</label><input type="number" id="cvsH" oninput="updateMenuMeta('canvas_height', this.value)"></div>
                </div>

                <!-- 自定义导出倍率 -->
                <div class="form-row">
                    <label>🚀 导出倍率 分辨率 (Export Scale)</label>
                    <div style="display:flex; align-items:center; gap:5px;">
                        <input type="number" step="0.1" min="0.1" id="expScaleInput"
                               oninput="updateMenuMeta('export_scale', this.value)"
                               placeholder="1.0" style="flex:1">
                    </div>
                    <div style="font-size:10px; color:#888; margin-top:4px;">
                        输入自定义倍率 (如 2.5)。<br>
                        基准 1000px * 2.5 = 导出 2500px 宽度。
                    </div>
                </div>

                <div class="form-row">
                    <label>默认每行列数 (Grid模式)</label>
                    <input type="number" id="columnInput" oninput="updateMenuMeta('layout_columns', this.value)" placeholder="默认为 3">
                </div>
                <div class="form-row">
                    <label>标题对齐方式</label>
                    <select id="alignSelect" onchange="updateMenuMeta('title_align', this.value)">
                        <option value="left">居左 (Left)</option>
                        <option value="center">居中 (Center)</option>
                        <option value="right">居右 (Right)</option>
                    </select>
                </div>
                <div class="form-row"><label>底色</label><div class="color-picker-row"><input type="color" id="cvsColorP" oninput="updateColor('canvas_color', this.value, 'pick')"><input type="text" id="cvsColorT" class="color-value" oninput="updateColor('canvas_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>背景图</label><div style="display:flex; gap:5px;"><select id="bgSelect" onchange="updateBg(this.value)" style="flex:1"></select><button class="btn btn-secondary" onclick="document.getElementById('bgUp').click()">⬆</button><input type="file" id="bgUp" hidden onchange="uploadFile('background', this)"></div></div>
                <div class="form-row"><label>背景适应</label><select id="bgFit" onchange="updateMenuMeta('bg_fit_mode', this.value)"><option value="cover_w">宽度填满</option><option value="custom">自定义</option></select></div>
            </div>

            <!-- 5. 阴影设置 -->
            <div class="section">
                <div class="section-title">
                    文本阴影 (Shadow)
                    <input type="checkbox" id="shadowEn" onclick="updateMenuMeta('shadow_enabled', this.checked)">
                </div>
                <div class="form-row">
                   <label>阴影颜色</label>
                   <div class="color-picker-row"><input type="color" id="shadowColP" oninput="updateColor('shadow_color', this.value, 'pick')"><input type="text" id="shadowColT" class="color-value" oninput="updateColor('shadow_color', this.value, 'text')"></div>
                </div>
                <div class="form-grid-2">
                    <div><label>偏移 X</label><input type="number" id="shadowX" oninput="updateMenuMeta('shadow_offset_x', this.value)"></div>
                    <div><label>偏移 Y</label><input type="number" id="shadowY" oninput="updateMenuMeta('shadow_offset_y', this.value)"></div>
                </div>
                <div class="form-row">
                    <label>模糊半径 (Feather)</label>
                    <input type="range" min="0" max="20" id="shadowR" oninput="updateMenuMeta('shadow_radius', this.value)">
                </div>
            </div>

            <!-- 2. 分组样式 -->
            <div class="section">
                <div class="section-title">默认样式设置</div>
                <div class="form-row"><label>1️⃣ 分组背景 (大框)</label><div class="form-grid-2"><input type="color" id="boxColor" oninput="updateMenuMeta('group_bg_color', this.value)"><input type="number" id="boxBlur" oninput="updateMenuMeta('group_blur_radius', this.value)" placeholder="模糊"></div><input type="range" min="0" max="255" id="boxAlpha" oninput="updateMenuMeta('group_bg_alpha', this.value); document.getElementById('alphaVal').innerText=this.value"><span id="alphaVal" style="float:right;font-size:10px">50</span></div>
                <div class="form-row"><label>2️⃣ 功能项背景 (小框)</label><div class="form-grid-2"><input type="color" id="iboxColor" oninput="updateMenuMeta('item_bg_color', this.value)"><input type="number" id="iboxBlur" oninput="updateMenuMeta('item_blur_radius', this.value)" placeholder="模糊"></div><input type="range" min="0" max="255" id="iboxAlpha" oninput="updateMenuMeta('item_bg_alpha', this.value); document.getElementById('ialphaVal').innerText=this.value"><span id="ialphaVal" style="float:right;font-size:10px">20</span></div>
            </div>

            <!-- 配色 -->
            <div class="section">
                <div class="section-title">全局配色 (默认值)</div>
                <div class="form-row"><label>🎨 主标题颜色</label><div class="color-picker-row"><input type="color" id="cTitleP" oninput="updateColor('title_color', this.value, 'pick')"><input type="text" id="cTitleT" class="color-value" oninput="updateColor('title_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>🎨 副标题颜色</label><div class="color-picker-row"><input type="color" id="cSubP" oninput="updateColor('subtitle_color', this.value, 'pick')"><input type="text" id="cSubT" class="color-value" oninput="updateColor('subtitle_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>🎨 分组标题颜色</label><div class="color-picker-row"><input type="color" id="cGTitleP" oninput="updateColor('group_title_color', this.value, 'pick')"><input type="text" id="cGTitleT" class="color-value" oninput="updateColor('group_title_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>🎨 分组副标题颜色</label><div class="color-picker-row"><input type="color" id="cGSubP" oninput="updateColor('group_sub_color', this.value, 'pick')"><input type="text" id="cGSubT" class="color-value" oninput="updateColor('group_sub_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>🎨 功能名颜色</label><div class="color-picker-row"><input type="color" id="cItemNameP" oninput="updateColor('item_name_color', this.value, 'pick')"><input type="text" id="cItemNameT" class="color-value" oninput="updateColor('item_name_color', this.value, 'text')"></div></div>
                <div class="form-row"><label>🎨 描述文字颜色</label><div class="color-picker-row"><input type="color" id="cItemDescP" oninput="updateColor('item_desc_color', this.value, 'pick')"><input type="text" id="cItemDescT" class="color-value" oninput="updateColor('item_desc_color', this.value, 'text')"></div></div>
            </div>

            <!-- 字体 -->
            <div class="section">
                <div class="section-title">全局字体 (默认值)</div>
                <div class="form-row"><label>主/副标题字体</label><select id="fTitle" onchange="updateMenuMeta('title_font', this.value)"></select></div>
                <div class="form-row"><label>分组标题字体</label><select id="fGTitle" onchange="updateMenuMeta('group_title_font', this.value)"></select></div>
                <div class="form-row"><label>分组副标题字体</label><select id="fGSub" onchange="updateMenuMeta('group_sub_font', this.value)"></select></div>
                <div class="form-row"><label>功能名字体</label><select id="fIName" onchange="updateMenuMeta('item_name_font', this.value)"></select></div>
                <div class="form-row"><label>功能描述字体</label><select id="fIDesc" onchange="updateMenuMeta('item_desc_font', this.value)"></select></div>
                <button class="btn btn-secondary btn-block" style="margin-top:5px" onclick="document.getElementById('fontUp').click()">📤 上传新字体</button>
                <input type="file" id="fontUp" hidden accept=".ttf,.otf" onchange="uploadFile('font', this)">
            </div>

            <!-- 分组列表 -->
            <div class="section">
                <div class="section-title">分组管理 <button class="icon-btn" onclick="addGroup()">+</button></div>
                <div id="groupList"></div>
            </div>

            <!-- 组件 -->
            <div class="section">
                <div class="section-title">装饰组件 <button class="icon-btn" onclick="addWidget('text')">+T</button> <button class="icon-btn" onclick="addWidget('image')">+I</button></div>
                <div id="widgetEditor" style="display:none; background:#333; padding:10px; border-radius:4px; margin-top:5px;">
                    <div id="wEdit-text" style="display:none">
                        <input id="widText" oninput="updateWidget('text', this.value)" style="margin-bottom:5px;width:100%">
                        <div style="margin-bottom:5px;">
                            <label style="font-size:10px;color:#aaa">字体</label>
                            <select id="widFontSelect" onchange="updateWidget('font', this.value)" style="width:100%"></select>
                        </div>
                        <div style="display:flex;gap:5px">
                            <input type="number" id="widSize" oninput="updateWidget('size', this.value)" style="width:60px" placeholder="Size">
                            <input type="color" id="widColor" oninput="updateWidget('color', this.value)" style="width:40px">
                        </div>
                    </div>
                    <div id="wEdit-image" style="display:none">
                        <div style="display:flex;gap:5px"><select id="widImgSelect" onchange="updateWidget('content', this.value)" style="flex:1"></select><button class="btn btn-secondary" onclick="document.getElementById('widImgUp').click()">⬆</button><input type="file" id="widImgUp" hidden onchange="uploadFile('widget_img', this)"></div>
                        <div style="display:flex;gap:5px;margin-top:5px"><input type="number" id="widW" oninput="updateWidget('width', this.value)"><input type="number" id="widH" oninput="updateWidget('height', this.value)"></div>
                    </div>
                    <button class="btn btn-danger btn-block" style="margin-top:5px" onclick="deleteWidget()">删除组件</button>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="workspace">
    <div id="canvas-wrapper" class="canvas-wrapper">
        <div id="canvas" class="canvas"></div>
    </div>
</div>

<script src="/static/editor.js?v=1.5"></script>
</body>
</html>